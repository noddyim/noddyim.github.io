<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no">
  <title>JD Map(2D)</title>
  <style>
    html,
    body,
    #viewDiv {
      padding: 20px;
      margin: 0;
      height: 95%;
      width: 95%;
    }
  </style>

  <link rel="stylesheet" href="https://js.arcgis.com/4.19/esri/themes/light/main.css">
  <script src="https://js.arcgis.com/4.19/"></script>

  <script>
    require([
     "esri/config",
     "esri/Map",
     "esri/views/MapView",
     "esri/widgets/Search",
     "esri/layers/FeatureLayer",
     "esri/renderers/SimpleRenderer",
     "esri/smartMapping/renderers/location"

    ], function(esriConfig,Map, MapView, Search,FeatureLayer,SimpleRenderer,locationRendererCreator) {

      esriConfig.apiKey = "AAPKd01249fc47b94ebf950169ad7fac07e2KhOYo3MgaiRiyQ3ohgiLPZubbRFyt5_c9OEViEhWKubugjIWUScFhLN9iEIYri9w";
      const map = new Map({
        basemap: "arcgis-topographic" // Basemap layer
      });
      
      //point sizes by scale
      const renderer = new SimpleRenderer({
          symbol: {
            type: "simple-marker", // autocasts as new SimpleMarkerSymbol()
            color: "dodgerblue",
            outline: {
              color: [255, 255, 255, 0.7],
              width: 0.5
            },
            size: 7.5
          }
        });

        const layer = new FeatureLayer({
          portalItem: {
            id: "cb1886ff0a9d4156ba4d2fadd7e8a139"
          },
          renderer: renderer
        });

        const baseLayer = new FeatureLayer({
          portalItem: {
            id: "2b93b06dc0dc4e809d3c8db5cb96ba69"
          },
          legendEnabled: false,
          popupEnabled: false,
          renderer: {
            type: "simple",
            symbol: {
              type: "simple-fill",
              color: [200, 200, 200, 0.75],
              outline: {
                color: "white",
                width: 0.5
              }
            }
          }
        });

        const map = new Map({
          layers: [baseLayer, layer]
        });


        const spatialReference = {
          wkid: 54035
        };

        const view = new MapView({
          container: "viewDiv",
          map: map,
          center: {
            x: 0,
            y: 0,
            spatialReference: spatialReference
          },
          spatialReference: spatialReference,
          scale: 100000000,
          constraints: {
            rotationEnabled: false
          },
          graphics: [
            {
              symbol: {
                type: "simple-fill",
                color: null,
                outline: {
                  width: 1,
                  color: [200, 200, 200, 0.75]
                }
              },
              geometry: {
                type: "extent",
                xmin: -180,
                xmax: 180,
                ymin: -90,
                ymax: 90,
                spatialReference: { wkid: 4326 }
              }
            }
          ]
        });

        const infoDiv = document.getElementById("infoDiv");
        view.ui.add(infoDiv, "top-right");

        const toggleButton = document.getElementById("toggle-auto-size");
        toggleButton.addEventListener("click", toggleAutoSize);

        function toggleAutoSize () {
          let sizeOptimizationEnabled = false;

          if(toggleButton.innerText === "Enable auto size by scale"){
            toggleButton.innerText = "Disable auto size by scale";
            sizeOptimizationEnabled = true;
          } else {
            toggleButton.innerText = "Enable auto size by scale";
          }

          // generates a new renderer with a scale-dependent
          // size visual variable to vary icon size by scale
          locationRendererCreator.createRenderer({
            layer: layer,
            view: view,
            sizeOptimizationEnabled: sizeOptimizationEnabled
          }).then((rendererResponse) => {
            // the renderer contains a size variable with stops
            // mapping icon sizes to scale values
            const renderer = rendererResponse.renderer;
            renderer.symbol.color = "dodgerblue";
            layer.renderer = renderer;
          }).catch((error) => {
            console.error(error);
          });
        }

      });
          
      //Search
      const searchWidget = new Search({
        view: view
      });
      // Adds the search widget below other elements in
      // the top left corner of the view
      view.ui.add(searchWidget, {
        position: "top-left",
        index: 2
      });

    });
  </script>
</head>

<body>
  <div id="viewDiv"></div>
</body>

</html>
